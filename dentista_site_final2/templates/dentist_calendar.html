{% extends 'base.html' %}{% block title %}Calendário Dentista{% endblock %}{% block content %}
<h2>Calendário - Disponibilidades</h2>
<p>Clique em um dia para adicionar uma hora (HH:MM). Clique em um evento verde para remover.</p>
<div id="calendar"></div>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const calendar = new FullCalendar.Calendar(document.getElementById('calendar'), {
    initialView: 'dayGridMonth',
    selectable: true,
    select: function(info) {
      const t = prompt('Hora (HH:MM) 24h, ex: 09:30');
      if(!t) return;
      fetch('/api/add_availability', {
        method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({date: info.startStr, time: t})
      }).then(r=>r.json()).then(j=>{ if(j.ok) calendar.refetchEvents(); else alert(j.msg||'Erro'); });
    },
    eventClick: function(info) {
      if(info.event.extendedProps.type === 'avail') {
        if(confirm('Remover disponibilidade?')) {
          fetch('/api/remove_availability', {
            method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({id: info.event.extendedProps.id})
          }).then(r=>r.json()).then(j=>{ if(j.ok) calendar.refetchEvents(); });
        }
      } else {
        alert(info.event.title);
      }
    },
    events: '/api/dentist_events'
  });
  calendar.render();
});
</script>
{% endblock %}
