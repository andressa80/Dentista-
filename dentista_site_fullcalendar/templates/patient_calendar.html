{% extends 'base.html' %}{% block title %}Calendário Paciente{% endblock %}{% block content %}
<h2>Calendário - Agende sua consulta</h2>
<div id='calendar'></div>
<script>
  document.addEventListener('DOMContentLoaded', function() {
    const calendarEl = document.getElementById('calendar');
    const calendar = new FullCalendar.Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      events: '/api/patient_slots',
      eventClick: function(info) {
        if(confirm('Deseja agendar nesta data/hora?')) {
          // date/time from ISO string
          const dt = info.event.start;
          const date = dt.toISOString().slice(0,10);
          const time = dt.toISOString().slice(11,16);
          fetch('/api/book', {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({date:date,time:time})})
            .then(r=>r.json()).then(j=>{ if(j.ok){ alert('Agendado!'); calendar.refetchEvents(); } else alert(j.msg||'erro') });
        }
      }
    });
    calendar.render();
  });
</script>
{% endblock %}
